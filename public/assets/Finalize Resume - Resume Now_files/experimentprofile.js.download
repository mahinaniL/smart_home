function _equalsIgnoreCase(e,t){return e&&t&&e.toLowerCase()==t.toLowerCase()||!1}window.Profile=window.Profile||{},window.globalCompVars=window.globalCompVars||{},Profile.isMagenta=false,Profile.profileStorageKey=Profile.isMagenta?"UserPersona":"UserProfile",Profile.experimentInfoStorageKey="ExperimentInfo",window.Profile.BaseUrl=window.location.origin,Profile.isStorageEnabled=!0,"object"==typeof PS&&"object"==typeof PS.Utility&&"function"==typeof PS.Utility.isStorageEnabled&&(Profile.isStorageEnabled=PS.StrgEnabled),window.Profile.GetCookie=function(e){var t=document.cookie,r=t.indexOf(" "+e+"=");return t=-1==(r=-1==r?t.indexOf(e+"="):r)?null:(r=t.indexOf("=",r)+1,-1==(e=t.indexOf(";",r))&&(e=t.length),unescape(t.substring(r,e)))},window.Profile.Init=function(e,t,r,i,o,a,n=!1){window.Profile.UpdateProfile({PremiumStatus:"Not Started",VisitedStages:[],Country:i,Role:r,UserId:e,LayerId:t,Device:o},a,n)},window.Profile.InitAsync=function(i,o,a,n,l,s,f=!1){return new Promise((t,r)=>{try{var e={PremiumStatus:"Not Started",VisitedStages:[],Country:n,Role:a,UserId:i,LayerId:o,Device:l};window.Profile.UpdateProfile(e,e=>{t(e),s&&"function"==typeof s&&s()},f)}catch(e){r(e)}})},window.Profile.ConductExperiment=function(e,t){var r=0;if(1==window.Profile.GetCookie("iso_retention_user"))return r;if(1==window.Profile.GetCookie("disabletests")){var i=window.Profile.GetCookie("runtest");if(i&&-1!==i.indexOf("_"))return r=i.split("_")[1]}var o=setDefaultValues(e),a=Profile.isStorageEnabled?JSON.parse(localStorage.getItem(Profile.profileStorageKey)):null;if(!a||!o.IsBackend&&!a.LayerId)return r;i=localStorage.getItem(Profile.experimentInfoStorageKey);if(i){i=JSON.parse(i).find(e=>e.experimentId===o.ExprId);if(i)return i.variant}var i=a&&a.VisitedStages&&0<a.VisitedStages.length?a.VisitedStages.filter(function(e){return e.userStageId==o.StageID&&(""===o.ProductCD||e.productCD==o.ProductCD)}):[],n=!(!o.UseRole||"Guest"==o.UseRole);if(o.conductforguestusers&&n)return r;if(!e.ignoreStageCheck&&!window.Profile.CheckStageEligibility(o.StageID,o.ProductCD))return r;if(e.isRCExperiment&&checktrialPurchaseDate(a.TrialPurchaseDate))return r;var n=!1,n=o.ExcludedCountry?-1==o.ExcludedCountry.indexOf(a.Country):o.Country&&(-1<o.Country.indexOf(a.Country)||o.Country.toString().toUpperCase().includes("ALL"));if(!(o.Device&&o.Device.toString().toUpperCase().includes(a.Device&&a.Device.toUpperCase()||"")&&n&&(o.PremiumStatus&&o.PremiumStatus.toString().toUpperCase()).includes(a.PremiumStatus&&a.PremiumStatus.toUpperCase()||"")))return r;if(e.updateUserStage&&i&&0<i.length&&(n=a.VisitedStages.indexOf(i[0]),e={userStageId:o.StageID,userStageDateTime:new Date,productCD:o.ProductCD},-1!=n?a.VisitedStages[n]=e:a.VisitedStages.push(e),Profile.isStorageEnabled)&&localStorage.setItem(Profile.profileStorageKey,JSON.stringify(a)),o.IsBackend&&conductBackendExperiment(a.UserId,o.ExprId,o.culture,o.logTraits,o.includeIterableIntegration,o.skipGoverning,t),window.experiment){if(r=window.experiment.conductUserExperiment(a.UserId,a.LayerId,o.ExprId).variant||0,experimentIdentityCall(a.UserId,o.exprName,o.variantDetails,r),t&&"function"==typeof t&&t(r),Profile.isMagenta)return r}else var l=setInterval(function(){if(void 0!==window.experiment&&(clearInterval(l),r=window.experiment.conductUserExperiment(a.UserId,a.LayerId,o.ExprId).variant||0,experimentIdentityCall(a.UserId,o.exprName,o.variantDetails,r),t&&"function"==typeof t&&t(r),Profile.isMagenta))return r},50)},window.Profile.UpdateUserPremiumStatus=function(e){var t;e&&Profile.isStorageEnabled&&((t=JSON.parse(localStorage.getItem(Profile.profileStorageKey))).PremiumStatus=e,localStorage.setItem(Profile.profileStorageKey,JSON.stringify(t)))},window.Profile.UpdateStage=function(t,r=""){var e,i,o;Profile.isStorageEnabled&&(o=(e=JSON.parse(localStorage.getItem(Profile.profileStorageKey))).VisitedStages.filter(function(e){return e.userStageId==t&&(""===r||_equalsIgnoreCase(e.productCD,r))}),i={userStageId:t,userStageDateTime:new Date,productCD:r},0<o.length?(o=e.VisitedStages.indexOf(o[0]),e.VisitedStages[o]=i):e.VisitedStages.push(i),localStorage.setItem(Profile.profileStorageKey,JSON.stringify(e)))},window.Profile.UpdateLoginStatus=function(e){var t;Profile.isStorageEnabled&&((t=JSON.parse(localStorage.getItem(Profile.profileStorageKey))).Role=e?"User":"Guest",localStorage.setItem(Profile.profileStorageKey,JSON.stringify(t)))},window.Profile.UpdateProfile=function(t,r,e=!1){var i,o,a=window.Profile.BaseUrl+(window.Profile.APISlug||"/eb/api")+"/v1/users/experimentprofile";a=(a=-1<window.location.hostname.indexOf("local")&&window.Profile.localURL?window.Profile.localURL+"/v1/users/experimentprofile":a)+"?getActiveExp="+e,Profile.isMagenta?(a=window.globalCompVars.BaseApiUrl+"users/experimentprofile",i=0,o=setInterval(async function(){"undefined"!=typeof MsgUtil&&MsgUtil&&(clearInterval(o),PS.APIEncryption.callAjax(a,"GET",!1,!0,!0,!0,function(e){e&&(e=JSON.parse(e),t.VisitedStages=e.userStageLogs,t.PremiumStatus=e.premiumStatus,t.TrialPurchaseDate=e.trialPurchaseDate,e.activeExperimentInfo)&&(e=e.activeExperimentInfo.map(e=>({experimentId:e.experimentId,variant:e.variant})),Profile.isStorageEnabled)&&localStorage.setItem(Profile.experimentInfoStorageKey,JSON.stringify(e)),Profile.isStorageEnabled&&localStorage.setItem(Profile.profileStorageKey,JSON.stringify(t)),r&&"function"==typeof r&&r()},!1)),10<i&&clearInterval(o),i++},500)):callAjaxExpProfile(a,"GET",!1,!0,function(e){e&&(e=JSON.parse(e),t.VisitedStages=e.userStageLogs,t.PremiumStatus=e.premiumStatus,t.TrialPurchaseDate=e.trialPurchaseDate,e.activeExperimentInfo)&&(e=e.activeExperimentInfo.map(e=>({experimentId:e.experimentId,variant:e.variant})),Profile.isStorageEnabled)&&localStorage.setItem(Profile.experimentInfoStorageKey,JSON.stringify(e)),Profile.isStorageEnabled&&localStorage.setItem(Profile.profileStorageKey,JSON.stringify(t)),r&&"function"==typeof r&&r()},!1)},window.Profile.UpdateTrialPurchaseDate=function(e){var t;Profile.isStorageEnabled&&((t=JSON.parse(localStorage.getItem(Profile.profileStorageKey))).TrialPurchaseDate=e,Profile.isStorageEnabled)&&localStorage.setItem(Profile.profileStorageKey,JSON.stringify(t))},window.Profile.CheckStageEligibility=function(t,r=""){var e,i,o=!0;return o=Profile.isStorageEnabled&&(e=(Profile.isStorageEnabled?JSON.parse(localStorage.getItem(Profile.profileStorageKey)):{}).VisitedStages.filter(function(e){return e.userStageId==t&&(""===r||_equalsIgnoreCase(e.productCD,r))}))&&0<e.length&&e[0].userStageDateTime&&(i=new Date,Math.round((i-new Date(e[0].userStageDateTime))/864e5)<14)?!1:o},window.Profile.CheckStgEligibilityAndReturnProfile=function(e,t=""){return{eligibility:window.Profile.CheckStageEligibility(e,t),UserProfile:Profile.isStorageEnabled?JSON.parse(localStorage.getItem(Profile.profileStorageKey)):null}},conductBackendExperiment=function(e,t,r,i=!0,o=!0,a=!0,n){var l,s,f=window.Profile.BaseUrl+(window.Profile.APISlug||"/eb/api")+"/v2/users/"+e+"/experiments/"+t+"/conduct";-1<window.location.hostname.indexOf("local")&&window.Profile.localURL&&(f=window.Profile.localURL+"/v2/users/"+e+"/experiments/"+t+"/conduct"),Profile.isMagenta?(f=window.globalCompVars.BaseApiUrlV2+"users/"+e+"/experiments/"+t+"/conduct",l=0,s=setInterval(async function(){"undefined"!=typeof MsgUtil&&MsgUtil&&(clearInterval(s),PS.APIEncryption.callAjax(f,"POST",!1,!0,!0,!0,n,!1,JSON.stringify(payload))),10<++l&&clearInterval(s)},500)):callAjaxExpProfile(f,"POST",!1,!0,n,!1,JSON.stringify({logTraits:i,conductForOldUsers:!0,includeIterableIntegration:o,culture:r,skipGoverning:a}))},setDefaultValues=function(e){return e.hasOwnProperty("PremiumStatus")||(e.PremiumStatus=["Not Started","Expired"]),e.hasOwnProperty("IsBackend")||(e.IsBackend=!1),e.hasOwnProperty("Country")||(e.Country=["ALL"]),e.hasOwnProperty("Device")||(e.Device="Desktop"),e.hasOwnProperty("culture")||(e.culture="en-US"),e.hasOwnProperty("ignoreStageCheck")||(e.ignoreStageCheck=!1),e},callAjaxExpProfile=function(e,t,r,i,o,a,n){var l=new XMLHttpRequest;l.onload=function(){4==l.readyState&&200==l.status?o&&(a?o(l.responseText,a):o(l.responseText)):4==l.readyState&&500==l.status&&o&&o("")},l.open(t,e,r),i&&(l.withCredentials=!0),n?(l.setRequestHeader("Content-Type","application/json;charset=UTF-8"),l.send(n)):l.send()},checktrialPurchaseDate=function(e){var t,r;return!e||(t=!1,r=new Date,14<Math.round((r-new Date(e))/864e5))||t},experimentIdentityCall=function(i,o,a,e){if(a&&0<Object.keys(a).length&&o){a=a[e];if(a){let e={["Experiment: "+o]:a},t=0,r=setInterval(()=>{"undefined"!=typeof TrackEvents&&"undefined"!=typeof analytics&&(clearInterval(r),TrackEvents("identify",e,i)),200<++t&&clearInterval(r)},100)}}};